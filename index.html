<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>JunkyManga.xyz â€“ Your Manga Recommendation Hub</title>
<style>
  /* Discord-like colors */
  :root {
    --blurple: #5865f2;
    --blurple-dark: #4752c4;
    --dark-bg: #2f3136;
    --darker-bg: #202225;
    --light-text: #dcddde;
    --muted-text: #b9bbbe;
  }

  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background-color: var(--darker-bg);
    color: var(--light-text);
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  header {
    background-color: var(--dark-bg);
    padding: 1rem 2rem;
    text-align: center;
    font-size: 1.5rem;
    font-weight: bold;
    color: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }

  main {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem;
    gap: 1.5rem;
  }

  select {
    background-color: var(--dark-bg);
    color: var(--light-text);
    padding: 0.6rem;
    font-size: 1rem;
    border: none;
    border-radius: 6px;
    outline: none;
  }

  button {
    background-color: var(--blurple);
    color: white;
    border: none;
    padding: 0.6rem 1.2rem;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  button:hover {
    background-color: var(--blurple-dark);
  }

  .result-box {
    background-color: var(--dark-bg);
    padding: 1rem 1.5rem;
    border-radius: 8px;
    max-width: 500px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }

  .result-box img {
    max-width: 200px;
    margin-top: 10px;
    border-radius: 6px;
  }

  footer {
    background-color: var(--dark-bg);
    padding: 0.5rem;
    text-align: center;
    font-size: 0.9rem;
    color: var(--muted-text);
  }
</style>
</head>
<body>

<header>ðŸ“š JunkyManga.xyz</header>

<main>
  <h2>Find Your Next Manga</h2>
  <label for="genre">Choose a genre:</label>
  <select id="genre">
    <option value="1">Action</option>
    <option value="2">Adventure</option>
    <option value="4">Comedy</option>
    <option value="8">Drama</option>
    <option value="10">Fantasy</option>
    <option value="22">Romance</option>
    <option value="30">Sports</option>
    <option value="37">Supernatural</option>
    <option value="62">Isekai</option>
  </select>
  <button id="recommendBtn">Get Recommendation</button>

  <div id="result" class="result-box" style="display: none;"></div>
</main>

<footer>Â© 2025 JunkyManga.xyz â€“ Made for manga lovers</footer>

<script>
  const resultBox = document.getElementById("result");
  let currentGenre = null;
  let remainingManga = [];

  document.getElementById("recommendBtn").addEventListener("click", async () => {
    const genreId = document.getElementById("genre").value;

    // If genre changed, fetch new list
    if (genreId !== currentGenre) {
      currentGenre = genreId;
      resultBox.style.display = "block";
      resultBox.innerHTML = "Fetching recommendation...";

      try {
        const res = await fetch(`https://api.jikan.moe/v4/manga?genres=${genreId}&order_by=score&sort=desc&limit=20`);
        const data = await res.json();

        if (!data.data || data.data.length === 0) {
          resultBox.innerHTML = "No manga found for this genre.";
          remainingManga = [];
          return;
        }

        remainingManga = [...data.data];
      } catch (err) {
        resultBox.innerHTML = "Error fetching data. Please try again.";
        console.error(err);
        return;
      }
    }

    // If no remaining, reset list
    if (remainingManga.length === 0) {
      resultBox.innerHTML = "You've seen all recommendations for this genre! Starting over...";
      try {
        const res = await fetch(`https://api.jikan.moe/v4/manga?genres=${currentGenre}&order_by=score&sort=desc&limit=20`);
        const data = await res.json();
        remainingManga = [...data.data];
      } catch (err) {
        console.error(err);
        return;
      }
    }

    // Pick random from remaining
    const index = Math.floor(Math.random() * remainingManga.length);
    const pick = remainingManga.splice(index, 1)[0]; // remove from list

    resultBox.innerHTML = `
      <strong>${pick.title}</strong><br>
      <em>Score: ${pick.score ?? "N/A"}</em><br>
      ${pick.synopsis ? pick.synopsis.substring(0, 200) + "..." : "No description available."}
      <br>
      <a href="${pick.url}" target="_blank" style="color: var(--blurple);">More Info</a>
      <br>
      ${pick.images?.jpg?.image_url ? `<img src="${pick.images.jpg.image_url}" alt="${pick.title} cover">` : ""}
    `;
  });
</script>

</body>
</html>
